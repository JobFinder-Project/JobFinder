<!-- filepath: /home/nicolas/Documentos/Disciplinas/Ger√™ncia de Configura√ß√£o/JobFinder/sistema/src/views/fun/empresaDashboard.hbs -->
<head>
    <link rel="stylesheet" href="/assets/css/empresaDashboard.css">
</head> 

<body>
    <nav class="navbar">
        <h1>JobFinder</h1>
        <div class="search-container">
            <form action="/empresa/candidatos/buscar" method="GET">
                <span class="search-icon"></span>
                <input type="text" name="q" class="search-input" placeholder="Buscar Candidatos üîç">
                <button type="submit" class="search-button">Buscar</button>
            </form>
        </div>
        <ul class="navbar-menu">
            <li>
                <a href="/logout">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z" />
                        <path fill-rule="evenodd"
                            d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z" />
                    </svg>
                </a>
            </li>
        </ul>
    </nav>

    <main class="main-content">
        <div class="category-tabs">
            <button class="tab active">Todos</button>
            <button class="tab">√Årea de TI</button>
            <button class="tab">Estoque</button>
            <button class="tab">Caixa</button>
            <button class="tab">Vendas</button>
        </div>
        <div class="candidates-grid">
            {{#each candidatos}}
            <div class="candidate-card">
                {{#if imagem}}
                <img src="{{imagem}}" alt="{{nome}}" class="candidate-image" />
                {{/if}}
                <h3 class="candidate-name">{{nome}}</h3>
                <p class="candidate-qualification">{{qualificacao}}</p>
                <button class="view-profile-button">Ver Perfil</button>
            </div>
            {{/each}}
        </div>
    </main>

    <nav class="bottom-nav custom-nav">
        <a href="javascript:void(0)" class="nav-btn" id="openVagasModal">
            <div class="nav-icon">
                <svg width="36" height="36" fill="#fff"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm1 15h-2v-2h2v2zm0-4h-2v-6h2v6z"/></svg>
            </div>
            <span>Vagas</span>
        </a>
        <a href="javascript:void(0)" class="nav-btn" id="openCriarVagaModal">
            <div class="nav-icon">
                <svg width="36" height="36" fill="#fff"><path d="M19 13h-6v6h-2v-6h-6v-2h6v-6h2v6h6v2z"/></svg>
            </div>
            <span>Add Vagas</span>
        </a>
        <a href="javascript:void(0)" class="nav-btn" id="openPerfilModal">
            <div class="nav-icon">
                <svg width="36" height="36" fill="#fff"><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/></svg>
            </div>
            <span>Perfil</span>
        </a>
    </nav>

    <div id="vagasModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" id="closeVagasModal">&times;</span>
            <div class="page-title">
                <h1>Vagas Dispon√≠veis</h1>
            </div>
            <div class="vagas-list-scroll">
                {{#if vagas.length}}
                {{#each vagas}}
                <div class="vaga-card-row">
                    {{#if this.imagem}}
                    <img src="{{this.imagem}}" alt="{{this.nome}}" class="job-image" />
                    {{/if}}
                    <div class="vaga-card-info">
                        <h2 class="job-title">{{this.nome}}</h2>
                        {{#if this.empresa}}
                        <span class="job-company">{{this.empresa.nome}}</span>
                        {{/if}}
                        <div class="vaga-info">
                            <span class="job-area">{{this.area}}</span>
                            <button class="view-job-button"
                                data-nome="{{this.nome}}"
                                data-area="{{this.area}}"
                                data-requisitos="{{this.requisitos}}"
                                data-empresa="{{this.empresa.nome}}"
                                data-imagem="{{this.imagem}}"
                            >Ver detalhes</button>
                        </div>
                    </div>
                </div>
                {{/each}}
                {{else}}
                <div class="no-data">
                    <p>N√£o existem vagas cadastradas.</p>
                </div>
                {{/if}}
            </div>
        </div>
    </div>

    <div id="criarVagaModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" id="closeCriarVagaModal">&times;</span>
            <div class="page-title">
                <h1>Criar Nova Vaga</h1>
            </div>
            <form class="form-add-vaga" action="/empresa/{{empresaId}}/vagas/criar" method="POST" enctype="multipart/form-data">
                <div class="form-row">
                    <label for="nome">Nome da Vaga:</label>
                    <input type="text" id="nome" name="nome" required>
                </div>
                <div class="form-row">
                    <label for="area">√Årea *</label>
                    <select id="area" name="area" required>
                        <option value="">Selecione</option>
                        <option value="Comercial/Vendas">Comercial/Vendas</option>
                        <option value="Administrativa">Administrativa</option>
                        <option value="Gastronomia">Gastronomia</option>
                        <option value="Log√≠stica">Log√≠stica</option>
                        <option value="Constru√ß√£o Civil">Constru√ß√£o Civil</option>
                        <option value="Industrial">Industrial</option>
                        <option value="Servi√ßos Gerais">Servi√ßos Gerais</option>
                        <option value="Finan√ßas">Finan√ßas</option>
                        <option value="Sa√∫de">Sa√∫de</option>
                        <option value="TI - Tecnologia da Informa√ß√£o">TI - Tecnologia da Informa√ß√£o</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="requisitos">Requisitos *:</label>
                    <textarea id="requisitos" name="requisitos" rows="4" required></textarea>
                </div>
                <div class="form-row">
                    <label for="imagem">Imagem da Vaga:</label>
                    <input type="file" id="imagem" name="imagem" accept="image/*">
                </div>
                <button type="submit" class="btn-add-vaga">Salvar Vaga</button>
            </form>
        </div>
    </div>

    <!-- Modal Detalhes da Vaga -->
    <div id="detalhesVagaModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" id="closeDetalhesVagaModal">&times;</span>
            <div class="page-title">
                <h1 id="detalhesVagaTitulo">Detalhes da Vaga</h1>
            </div>
            <div id="detalhesVagaBody">
                <!-- Conte√∫do din√¢mico da vaga ser√° inserido aqui via JS -->
            </div>
        </div>
    </div>

    <!-- Modal Visualizar Perfil -->
    <div id="perfilModal" class="modal" style="display:none;">
        <div class="modal-content perfil-modal">
            <span class="close" id="closePerfilModal">&times;</span>
            <div class="page-title">
                <h1>Meu Perfil</h1>
            </div>
            <div class="perfil-visualizacao">
                <div class="perfil-info-card">
                    <div class="info-row">
                        <strong>Nome da Empresa:</strong>
                        <span id="visualNome">{{user.nome}}</span>
                    </div>
                    <div class="info-row">
                        <strong>CNPJ:</strong>
                        <span id="visualCnpj">{{user.cnpj}}</span>
                    </div>
                    <div class="info-row">
                        <strong>Email:</strong>
                        <span id="visualEmail">{{user.email}}</span>
                    </div>
                    <div class="info-row">
                        <strong>Telefone:</strong>
                        <span id="visualFone">{{user.fone}}</span>
                    </div>
                    <div class="info-row">
                        <strong>Biografia:</strong>
                        <span id="visualBio">{{user.bio}}</span>
                    </div>
                    <div class="info-row">
                        <strong>Site:</strong>
                        <span id="visualSite">{{user.site}}</span>
                    </div>
                </div>
                <div class="perfil-actions">
                    <button type="button" class="btn-add-vaga" id="editarPerfilBtn">Editar Perfil</button>
                    <button type="button" class="back-button" id="closePerfilModalBtn">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Perfil -->
    <div id="editarPerfilModal" class="modal" style="display:none;">
        <div class="modal-content perfil-modal">
            <span class="close" id="closeEditarPerfilModal">&times;</span>
            <div class="page-title">
                <h1>Editar Perfil</h1>
            </div>
            <form class="form-add-vaga" id="formEditarPerfil" action="/empresa/{{user._id}}/editar" method="POST">
                <div class="form-row">
                    <label for="editNome">Nome:</label>
                    <input type="text" id="editNome" name="nome" value="{{user.nome}}" required>
                </div>
                <div class="form-row">
                    <label for="editCnpj">CNPJ:</label>
                    <input type="text" id="editCnpj" name="cnpj" value="{{user.cnpj}}" required>
                </div>
                <div class="form-row">
                    <label for="editEmail">Email:</label>
                    <input type="email" id="editEmail" name="email" value="{{user.email}}" required>
                </div>
                <div class="form-row">
                    <label for="editFone">Telefone:</label>
                    <input type="text" id="editFone" name="fone" value="{{user.fone}}" required>
                </div>
                <div class="form-row">
                    <label for="editBio">Biografia</label>
                    <textarea id="editBio" name="bio">{{user.bio}}</textarea>
                </div>
                <div class="form-row">
                    <label for="editSite">Site</label>
                    <input type="url" name="site" id="editSite" value="{{user.site}}">
                </div>
                <button type="submit" class="btn-add-vaga">Salvar altera√ß√µes</button>
                <button type="button" class="back-button" id="voltarVisualizarBtn">Voltar</button>
            </form>
        </div>
    </div>

    <script>
    // Abrir modais principais
    document.getElementById('openVagasModal').onclick = function() {
        document.getElementById('vagasModal').style.display = 'flex';
    }
    document.getElementById('closeVagasModal').onclick = function() {
        document.getElementById('vagasModal').style.display = 'none';
    }
    document.getElementById('openCriarVagaModal').onclick = function() {
        document.getElementById('criarVagaModal').style.display = 'flex';
    }
    document.getElementById('closeCriarVagaModal').onclick = function() {
        document.getElementById('criarVagaModal').style.display = 'none';
    }
    
    // Controle do modal de perfil (visualiza√ß√£o)
    document.getElementById('openPerfilModal').onclick = function() {
        document.getElementById('perfilModal').style.display = 'flex';
    }
    document.getElementById('closePerfilModal').onclick = function() {
        document.getElementById('perfilModal').style.display = 'none';
    }
    document.getElementById('closePerfilModalBtn').onclick = function() {
        document.getElementById('perfilModal').style.display = 'none';
    }

    // Controle do modal de edi√ß√£o de perfil
    document.getElementById('editarPerfilBtn').onclick = function() {
        // Fechar modal de visualiza√ß√£o e abrir modal de edi√ß√£o
        document.getElementById('perfilModal').style.display = 'none';
        document.getElementById('editarPerfilModal').style.display = 'flex';
    }
    
    document.getElementById('closeEditarPerfilModal').onclick = function() {
        document.getElementById('editarPerfilModal').style.display = 'none';
    }
    
    document.getElementById('voltarVisualizarBtn').onclick = function() {
        // Fechar modal de edi√ß√£o e voltar para visualiza√ß√£o
        document.getElementById('editarPerfilModal').style.display = 'none';
        document.getElementById('perfilModal').style.display = 'flex';
    }

    // Modal Detalhes da Vaga
    function abrirDetalhesVaga(vaga) {
        document.getElementById('detalhesVagaTitulo').innerText = vaga.nome || 'Detalhes da Vaga';
        document.getElementById('detalhesVagaBody').innerHTML = `
            ${vaga.imagem ? `<img src="${vaga.imagem}" alt="${vaga.nome}" style="max-width:200px;margin-bottom:16px;">` : ''}
            <p><strong>√Årea:</strong> ${vaga.area || ''}</p>
            <p><strong>Requisitos:</strong> ${vaga.requisitos || ''}</p>
            <p><strong>Empresa:</strong> ${vaga.empresa || ''}</p>
        `;
        document.getElementById('detalhesVagaModal').style.display = 'flex';
    }

    // Adiciona evento nos bot√µes "Ver detalhes" das vagas
    document.querySelectorAll('.view-job-button').forEach(function(btn) {
        btn.onclick = function(e) {
            e.preventDefault();
            const vaga = {
                nome: btn.getAttribute('data-nome'),
                area: btn.getAttribute('data-area'),
                requisitos: btn.getAttribute('data-requisitos'),
                empresa: btn.getAttribute('data-empresa'),
                imagem: btn.getAttribute('data-imagem')
            };
            abrirDetalhesVaga(vaga);
        };
    });

    document.getElementById('closeDetalhesVagaModal').onclick = function() {
        document.getElementById('detalhesVagaModal').style.display = 'none';
    };

    // Fechar modais ao clicar fora
    window.onclick = function(event) {
        ['vagasModal', 'criarVagaModal', 'perfilModal', 'editarPerfilModal', 'detalhesVagaModal'].forEach(function(id) {
            var modal = document.getElementById(id);
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });
    }

    // AJAX para editar perfil sem redirecionar
    document.getElementById('formEditarPerfil').onsubmit = async function(e) {
        e.preventDefault();
        const form = e.target;
        const data = {
            nome: form.editNome.value,
            cnpj: form.editCnpj.value,
            email: form.editEmail.value,
            fone: form.editFone.value,
            bio: form.editBio.value,
            site: form.editSite.value
        };
        
        try {
            const res = await fetch(form.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            
            if (res.ok) {
                // Atualizar os dados na visualiza√ß√£o
                document.getElementById('visualNome').textContent = data.nome;
                document.getElementById('visualCnpj').textContent = data.cnpj;
                document.getElementById('visualEmail').textContent = data.email;
                document.getElementById('visualFone').textContent = data.fone;
                document.getElementById('visualBio').textContent = data.bio;
                document.getElementById('visualSite').textContent = data.site;
                
                // Fechar modal de edi√ß√£o e voltar para visualiza√ß√£o
                document.getElementById('editarPerfilModal').style.display = 'none';
                document.getElementById('perfilModal').style.display = 'flex';
                
                alert('Perfil atualizado com sucesso!');
            } else {
                const error = await res.json();
                alert('Erro ao salvar altera√ß√µes: ' + (error.error || 'Erro desconhecido'));
            }
        } catch (error) {
            console.error('Erro na requisi√ß√£o:', error);
            alert('Erro ao conectar com o servidor');
        }
    };
    </script>
</body>
</html>